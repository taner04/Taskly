@page "/todo"
@using Web.Models
@attribute [Authorize]
@attribute [StreamRendering]
@inject HttpClient HttpClient

<PageTitle>Todos</PageTitle>

<h1>Todos</h1>

@if (todos == null || todos.Count == 0)
{
    <div class="empty-message">
        <div class="empty-title">No todos yet</div>
        <div class="empty-subtitle">You haven't added any tasks.</div>
    </div>
}
else
{
    <div class="todo-container">

        <div class="toggle-row">
            <RadzenCheckBox @bind-Value="@allowVirtualization" Name="allowVirtualization" />
            <RadzenLabel Text="Virtualization" Component="allowVirtualization" />
        </div>

        <RadzenDataList AllowVirtualization="@allowVirtualization"
                        Style="@(allowVirtualization ? "height:400px;overflow:auto;" : "")"
                        WrapItems="true"
                        AllowPaging="@(!allowVirtualization)"
                        Data="@todos"
                        TItem="TodoModel"
                        PageSize="10"
                        PagerHorizontalAlign="HorizontalAlign.Left"
                        ShowPagingSummary="true">
            
            <EmptyTemplate>
                <div class="empty-message">
                    <div class="empty-title">No todos yet</div>
                    <div class="empty-subtitle">You haven't added any tasks.</div>
                </div>
            </EmptyTemplate>

            <Template Context="todo">
                <div class="todo-card">

                    <!-- Header -->
                    <div class="todo-card-header">
                        <span class="todo-card-title">@todo.Title</span>

                        @if (!string.IsNullOrWhiteSpace(todo.Priority))
                        {
                            <RadzenBadge class="badge-priority"
                                         Text="@todo.Priority" />
                        }
                    </div>

                    <!-- Description -->
                    @if (!string.IsNullOrWhiteSpace(todo.Description))
                    {
                        <div class="todo-card-description">@todo.Description</div>
                    }

                    <!-- Footer -->
                    <div class="todo-card-footer">

                        <RadzenBadge class="@(todo.IsCompleted ? "status-done" : "status-open")"
                                     Text="@(todo.IsCompleted ? "Done" : "Open")" />

                        <RadzenButton Text="Details"
                                      Click="@(() => ViewDetails(todo))"
                                      class="details-btn" />
                    </div>

                </div>

            </Template>

        </RadzenDataList>
    </div>
}

<style>

    /* ----- Page Layout ----- */
    .todo-container {
        width: 100%;
        padding: 1rem;
        font-family: -apple-system, BlinkMacSystemFont, "San Francisco", Helvetica, Arial, sans-serif;
    }

    .toggle-row {
        display: flex;
        align-items: center;
        gap: .6rem;
        margin: 1rem 0 1.4rem 0;
        color: #555;
    }


    /* ----- Apple Style Cards ----- */
    .todo-card {
        width: 100%;
        box-sizing: border-box;
        background: #ffffff;
        border-radius: 18px;
        padding: 18px 20px;
        margin-bottom: 18px;
        box-shadow: 0 4px 18px rgba(0, 0, 0, 0.08);
        transition: all .25s ease;
    }

    .todo-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 26px rgba(0, 0, 0, 0.14);
    }

    .todo-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: .4rem;
    }

    .todo-card-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: #111;
        letter-spacing: -.2px;
    }

    .todo-card-description {
        color: #555;
        font-size: .95rem;
        margin: .5rem 0 1rem 0;
        line-height: 1.35rem;
    }

    .todo-card-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: .5rem;
    }

    .badge-priority {
        background: #e3e6ec !important;
        color: #3a3f48 !important;
        padding: 6px 12px !important;
        border-radius: 12px !important;
        font-size: .85rem !important;
        font-weight: 500 !important;
    }

    .status-done {
        background: #d1f7d6 !important;
        color: #1c7c2c !important;
        padding: 6px 14px !important;
        border-radius: 12px !important;
        font-weight: 600 !important;
    }

    .status-open {
        background: #fde8d8 !important;
        color: #c45a00 !important;
        padding: 6px 14px !important;
        border-radius: 12px !important;
        font-weight: 600 !important;
    }

    .details-btn {
        border-radius: 12px !important;
        background: #007aff !important;
        color: #fff !important;
        padding: 7px 18px !important;
        font-weight: 500 !important;
        box-shadow: 0 3px 12px rgba(0,122,255,0.32);
        transition: all .2s ease-in-out;
    }

    .details-btn:hover {
        background: #0062d6 !important;
        box-shadow: 0 6px 18px rgba(0,122,255,0.5);
    }

    .empty-message {
        width: 100%;
        text-align: center;
        padding: 40px 0;
        color: #555;
        font-family: -apple-system, BlinkMacSystemFont, "San Francisco", Arial, sans-serif;
    }

    .empty-title {
        font-size: 1.4rem;
        font-weight: 600;
        color: #222;
        margin-bottom: 6px;
    }

    .empty-subtitle {
        font-size: 1rem;
        opacity: 0.8;
    }

</style>


@code {
    bool allowVirtualization;
    private List<TodoModel> todos = [];
    [CascadingParameter] private Task<AuthenticationState>? authenticationState { get; set; }
    private string Username = "";

    protected override async Task OnInitializedAsync()
    {
        await Task.Delay(500);

        todos.AddRange(new TodoModel[]
        {
            new TodoModel { Id = Guid.NewGuid(), Title = "Learn Blazor", Priority = "High", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Build a Blazor app", Priority = "Medium", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Deploy the app", Priority = "Low", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Learn Blazor", Priority = "High", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Build a Blazor app", Priority = "Medium", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Deploy the app", Priority = "Low", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Learn Blazor", Priority = "High", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Build a Blazor app", Priority = "Medium", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Deploy the app", Priority = "Low", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Learn Blazor", Priority = "High", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Build a Blazor app", Priority = "Medium", IsCompleted = false },
            new TodoModel { Id = Guid.NewGuid(), Title = "Deploy the app", Priority = "Low", IsCompleted = false }
        });

        if (authenticationState is not null)
        {
            var state = await authenticationState;

            Username = state?.User?.Identity?.Name ?? string.Empty;
        }
    }

    void ViewDetails(TodoModel todo)
    {
        // Custom logic
    }
}
